<html>

<head>
    <title>Virtual Inspection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> -->
    <link href="main.css" rel="stylesheet">
	<link href="css/app.css" rel="stylesheet">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""
    ></script>
	
<script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script type="text/javascript"        src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script type="text/javascript"        src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js"></script>
	<script type="text/javascript"        src="js/myjs.js"></script>
	<script type="text/javascript"        src="js/sendSms.js"></script>
	<script type="text/javascript">
	
	$(document).ready(function()
			{
				const queryString = window.location.search;
				const urlParams = new URLSearchParams(queryString);
				//document.getElementById("calimnum").placeholder= urlParams.get('claimNum');
				document.getElementById("calimnum").innerHTML= urlParams.get('claimNum');
				document.getElementById("mobilenum").innerHTML = urlParams.get('mobileNum');
					
				$("#tablemain").simpleResizableTable(); //.css('background-color', 'red');
				
			});
			
				
	</script>
	
	

	
<style type="text/css">
#claimTable td {
	font-size: 14px;
}
#tablemain th {
	font-size: 12px;
}
 video {
	width: 100%;
	height: auto;
} 

.srt-draghandle {
    opacity: 0 ;
}

</style>
</head>

<body onload="sendfirstSMS()">
<nav class="navbar navbar-expand-lg  navbarBGcolor fixed-top padzero"> </nav>
		<nav class="navbar navbar-default navbar-fixed-top"
		id="transient-header">
	
		<div class="box effect2">
			<nav class="navbar navbar-default ct_navbar">
				<div class="container-fluid">
					<div class="navbar-header">
						<img src="css/imgs/LTIlogo.png" align="top" />
						<ul class="nav navbar-nav navbar-right pull-right marzero padzero">
							<li><img src="css/imgs/abcins-c.PNG"></li>
						</ul>
					</div>
				</div>
			</nav>

		</div>
	</nav>
	<div class="col-md-12 col-lg-12 col-sm-12 col-xs-12 padzero">
		<div class="header1" align="center"> <span style="color: black; font-size: 20px; font-weight: bold;" class="internal_header">Claim Details</span>
            <span style="color: blue; font-size: 18px; font-weight: bold;"> Claim Number :</span>
            <!-- <input type= text id ="calimnum" name="ClaimNo" placeholder="Names"/> -->
            <span style="color: red; " id="calimnum"></span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;
            <span style="color: blue; font-size: 18px; font-weight: bold;">Mobile Number :</span>
            <span style="color: red;" id="mobilenum"></span>
        </div>
	</div>
	
	
	<table class="table marzero" id="tablemain" border="1">
		<thead>
			<tr>
				<th></th>
				<th><img src="css/imgs/Live-Stream.png" width="110" height="20"></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>
				<table class="table marzero" id="claimTable">
							<tbody> 
							<tr></tr>
							<tr>
								<td style="color: #0000ff">Claim Number</td>
								<td><input type="text" class="form-control"id="claimNo"  /></td>
							</tr>
							<tr>
								<td style="color: #0000ff">Mobile Number</td>
								<td><input type="text" class="form-control" id="mobileNo"/></td>
							</tr>
							<tr>
								<td style="color: #0000ff">Note</td>
								<td><textarea rows="06" cols="25" id="note"></textarea></td>
							</tr>
							<tr>
								<td></td>
								<td>
									<button type="button" onclick="sendSms()" class="btn btn-success"
										style="height: 30px; width: 150px; background-color: #e7e7e7; color: black;">
										Resend SMS</button>
								</td>
							</tr>
							<tr>
							<td colspan="2">
                                <div id="snapShots" style="height:355px; border:black"></div>
                            </td>
							</tr>
							</tbody> 
						</table>
					
				</td>
				<td>
				
						    <div class="container-fluid">
        <div class="row h-10 w-100" style="display:none">
            <div class="col">
                <select id="filter" class="w-100 bg-dark text-light ml-2 mt-2 select font-weight-bold border">
                    <option value="none">Normal</option>
                    <option value="grayscale(100%)">B & W</option>
                    <option value="sepia(100%)">Old School</option>
                    <option value="contrast(150%)">Lumination</option>
                    <option value="blur(20px)">Hidden Mist</option>
                    <option value="invert(100%)">Dracula</option>
                    <option value="hue-rotate(180deg">X-men Beast</option>
                    <option value="saturate(25)">Super Saiyan God</option>
                </select>
            </div>
            <div class="col">
                <div class="float-right mt-3">
                    <input class="form-check-input" type="checkbox" id="theme">
                    <label class="form-check-label" for="theme">
                        Dark Theme
                    </label>
                </div>
            </div>
        </div>
        <div class="row h-100 w-100" style="margin: 20px 20px 20px 0px;">
            <div class="col-12 col-sm-6 d-flex justify-content-center" style="display:none !important">
                <div class="embed-responsive embed-responsive-16by9">
                    <video class="embed-responsive-item" muted></video>
                </div>
            </div>
            <div >
                <div id="peerDiv" style="transform: rotateY(180deg); " class="embed-responsive embed-responsive-16by9">
                </div>
            </div>
        </div>
    </div>
						
						
						
						<div class="Video">
						
							<button id="btn-start-recording" type="button"
								class="btn btn-success" style="height: 30px; width: 150px" onclick="captureCamera()">Start
								Recording</button>
							<button id="btn-stop-recording" type="button"
								style="height: 30px; width: 150px;display=none !important;" class="btn btn-danger" onclick="stopRecording()">Stop
								Recording</button>
							<a id="download"  style="background-color: chocolate;padding: 6px 9px 6px 9px;border-radius: 5px;color: white; display=none !important" >Download The Stream</a>
							
							
							
							<image src="" id="theimage"></image>
							
								<a id="download1" download="image.jpeg" onclick="snap()"  style="background-color: #804887;padding: 6px 9px 6px 9px; border-radius: 5px;color: white; display=none !important;"}>Snap & Download </a>
							<button id = "snap" type="button" class="btn btn-info"
								style="height: 30px; width: 150px">Annotate Picture</button>
							<script src="js/mystream.js"> </script>

						</div>
					
				</td>
			</tr>
		</tbody>
	</table>
	<div id="map"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="bundle.js"></script>
</body>
<script>

document.onload = function() {myFunction()};

function myFunction() {
  document.getElementById('btn-stop-recording').onload = true;
}
 
 document.onload = function(){myScript};
 var mediaRecorder; // globally accessible
        const options = {mimeType: 'video/webm'};
        var recordedChunks = [];
        var downloadLink = document.getElementById('download');

        function captureCamera() {
		document.getElementById("btn-stop-recording").style.display="inline"
		document.getElementById("btn-start-recording").style.display="none"

           'use strict';
const incomingStream = document.getElementById('peerVideo');
  let stream;
  const fps = 0;
  if (incomingStream.captureStream) {
    stream = incomingStream.captureStream(fps);
  } else if (incomingStream.mozCaptureStream) {
    stream = incomingStream.mozCaptureStream(fps);
  } else {
    console.error('Stream capture is not supported');
    stream = null;
  }
startCameraRecording(stream)
}

        function startCameraRecording(stream) {
            document.getElementById('btn-start-recording').disabled = true;
            document.getElementById('btn-start-recording').disabled = false;
				
                mediaRecorder = new MediaRecorder(stream, options);

                mediaRecorder.addEventListener('dataavailable', function(e) {
                  if (e.data.size > 0) {
                    recordedChunks.push(e.data);
                    console.log("e.data="+e.data);
                  }
                });
                  mediaRecorder.start();
                  InitUploading();
        }

        function stopRecording() {
			document.getElementById("btn-start-recording").style.display="inline"
			document.getElementById("download").style.display="inline"


           /* document.getElementById('btn-stop-recording').disabled = true;
            document.getElementById('btn-start-recording').disabled = false; */
            mediaRecorder.stop();
            mediaRecorder.addEventListener('stop', function() {
                downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
                downloadLink.download = 'acetest.webm';
              });

        }
		function InitUploading() {
            // get recorded blob
            blob = new Blob(recordedChunks,{'type' : 'video/webm'});
            console.log("recordedChunks="+recordedChunks);
            console.log("blob="+blob)
			url = window.URL.createObjectURL(blob);
				this.href = url;
				this.target = '_blank';
  	
			this.download = 'my-download.webm';
            

        }
		var a = 0;
		var my_width = "300"
		        
      function snap() {
		var i =0 
		   if(a>0){
		   while(i<a){
			var photos = document.getElementById("canvas"+i)
			photos.style.width = my_width/a+1 
			i = i+1    
		   }  
		   }
	  			document.getElementById("download1").style.display="inline"

			  
			
		 var canvas = document.createElement('canvas');
        div = document.getElementById("snapShots"); 
        canvas.id     = "canvas"+a;
        canvas.style.width = my_width/a+1
        canvas.classList.add("images");
        
        console.log(canvas.id)
        div.appendChild(canvas)
            
        var video = document.getElementById('peerVideo');
        var cname= a.toString()    
        console.log("canvas"+cname)
         var canvas = document.getElementById("canvas"+cname)
         canvas.style.margin = "2px";
         var context = canvas.getContext('2d');
         var myWidth, myHeight, ratio;
         
         a= a+1;
         var context = canvas.getContext('2d');
         var myWidth, myHeight, ratio;
         
         video.addEventListener('loadedmetadata', function() {
            //ratio = video.videoWidth/video.videoHeight;
            //myWidth = video.videoWidth-100;
            //myHeight = parseInt(ratio,10);
            var reader = new FileReader();
                       
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            

         },false);
	  
	  
	  
	  
            context.fillRect(0,0,canvas.width,canvas.height);
            context.drawImage(video,0,0,canvas.width,canvas.height);
            var download = document.getElementById("download1");   
         
         	var imageUrl = canvas.toDataURL("image/png")
                  .replace("image/png", "image/octet-stream");
         	
         	download.setAttribute("href", imageUrl);
         	//document.getElementById("theimage").src = imageUrl;
			
			
			
      }
	    console.log(localStorage.getItem("latitude"))
		
		
	var acc = 50
    var map = L.map('map',{
    center: [21.457462,92.54874],
    zoom: 18
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    L.marker([21.457462,92.54874]).addTo(map)
    .bindPopup('Insured Location (Accuracy: '+acc+" metres)" )
    .openPopup();

</script>

</html>